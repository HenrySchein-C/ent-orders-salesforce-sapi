<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:module-logging="http://www.mulesoft.org/schema/mule/module-logging"
	xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce"
	xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:os="http://www.mulesoft.org/schema/mule/os" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/os http://www.mulesoft.org/schema/mule/os/current/mule-os.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd
http://www.mulesoft.org/schema/mule/module-logging http://www.mulesoft.org/schema/mule/module-logging/current/mule-module-logging.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	
	<sub-flow name="salesforce-Order-Creation" doc:id="d3f9cb4f-3adb-4a04-94c9-a8d0922c67f7" >
		<set-variable value="#[now()]" doc:name="Set Variable" doc:id="afa5193f-3f16-4d95-adea-88764d4c58bf" variableName="vDebugStartTime" />
		<module-logging:debug-start-logger doc:name="Debug start logger" doc:id="fab9ad04-dae3-4d3b-9603-2aa8173c05dd" Application_Name="#[app.name]" Flow_Name="#[vars.vFlowName]" Transaction_Id="#[vars.vCorrelationId]" Correlation_Id="#[vars.vCorrelationId]" Environment="${environment}" Source="${operations.constants.source}" Target="${operations.constants.target}" Message="#['Debug call for salesforce order creation sapi for  started']" />
		<http:request method="POST" doc:name="update-Order-Creation" doc:id="f70efe3e-539d-46d5-9dc4-d3781f126d1a" path="/apexrest/SFOrderCreation" config-ref="HTTP_Request_configuration_token">
			<http:headers><![CDATA[#[output application/json
---
{
	"Authorization" : "Bearer " ++ vars.targetToken.access_token
}]]]></http:headers>
		</http:request>
		<module-logging:debug-end-logger doc:name="Debug end logger" doc:id="2c286264-aa05-40ee-984d-235e0e4eb6a7" Application_Name="#[app.name]" Flow_Name="#[vars.vFlowName]" Transaction_Id="#[vars.vCorrelationId]" Correlation_Id="#[vars.vCorrelationId]" Environment="${environment}" Source="{operations.constants.source}" Target="{operations.constants.target}" Message="#['Debug call for salesforce order creation sapi for  ended']" Time_Taken="#[output application/json --- now() - vars.vDebugStartTime]" />
	</sub-flow>
	<sub-flow name="acccess-Oauth2-Token" doc:id="7bfc421c-e969-44f1-ab83-e60e6a99b8ba" >
		<set-variable value="#[now()]" doc:name="Set Variable" doc:id="ef62508f-b5ef-4efd-aece-4152e01b69c3" variableName="vDebugStartTime" />
		<module-logging:debug-start-logger doc:name="Debug start logger" doc:id="d6df7049-7fd2-4604-aa8e-5739f1420bfa" Application_Name="#[app.name]" Flow_Name="#[vars.vFlowName]" Transaction_Id="#[vars.vCorrelationId]" Correlation_Id="#[vars.vCorrelationId]" Environment="${environment}" Source="${operations.constants.source}" Target="${operations.constants.target}" Message="#['Invoke salesforce token sapi for Debug started']" />
		<http:request method="POST" doc:name="fetch-Token-call" doc:id="8ad24511-ac0c-4b3b-9285-32d6081cd7c7" target="targetToken" config-ref="HTTP_Request_configuration_token" path="/oauth2/token">
			<http:query-params><![CDATA[#[output application/java
---
{
"grant_type" : Mule::p('salesforce.grant.type'),
"client_id" : Mule::p('salesforce.headers.client.id'),
"client_secret" : Mule::p('salesforce.headers.client.secret'),
"username": Mule::p('salesforce.headers.client.username'),
"password": Mule::p('salesforce.headers.client.password')
}]]]></http:query-params>
		</http:request>
		<module-logging:debug-end-logger doc:name="Debug end logger" doc:id="7e51168e-f99a-4d70-b333-c255bc3d4105" Application_Name="#[app.name]" Flow_Name="#[vars.vFlowName]" Transaction_Id="#[vars.vCorrelationId]" Correlation_Id="#[vars.vCorrelationId]" Environment="${environment}" Source="{operations.constants.source}" Target="{operations.constants.target}" Message="#['Debug call for salesforce token sapi ended']" Time_Taken="#[output application/json --- now() - vars.vDebugStartTime]" />
	</sub-flow>
	<sub-flow name="access_Salesforce_Sub_Flow" doc:id="e089fee6-1e56-436d-8466-3bd3403ee96f" >
		<flow-ref doc:name="Flow Reference" doc:id="943f3937-108e-4043-a530-a55a2f59830a" name="acccess-Oauth2-Token" />
		<flow-ref doc:name="Flow Reference" doc:id="a0f89be5-39df-4d34-98e3-63f0ee29eaee" name="salesforce-Order-Creation" />
	</sub-flow>
</mule>
